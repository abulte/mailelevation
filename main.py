#!/usr/bin/env python
# -*- coding: utf-8 -*-
 
# Copyright 2013 Alexandre Bulté <alexandre[at]bulte[dot]net>
# 
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

from flask import Flask, request
app = Flask(__name__)

app.debug = True

@app.route('/incoming/email', methods=['POST'])
def mail_receive():
    app.logger.info('-- Received incoming email --')
    app.logger.info(request.form)
    app.logger.info(request.files)
    
    mfrom = request.form.items()
    # .get('From', False)
    app.logger.debug(mfrom)
    # app.logger.debug(request.files.get('attachments'))
    # if request.files.get('attachments', False):
    #     if len(request.files.get('attachments')) > 0:
    #         app.logger.debug(request.files.get('attachments'))
    # else:
    #     pass
    return 'OK'

@app.route('/')
def index():
    return """
<h1>Convert a GPX to an ASCII elevation profile</h1>

<p>Send an email with a GPX attached (max 100ko) to 
<a href="mailto:b29d062265b9b6b211c0@cloudmailin.net">b29d062265b9b6b211c0@cloudmailin.net</a>, 
and you'll receive the elevation profile in reply.</p>

<p>Currently, only tracks (not routes) are processed from GPX file.</p>

<pre>
# Copyright 2013 Alexandre Bulté &lt;alexandre[at]bulte[dot]net&gt;
# 
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
</pre>

<pre>
MIN : 785.56
MAX : 2107.73
TOTAL : 1322.17
POSITIF CUM. : 10853.11
NEGATIF CUM. : -124272.85

One * is 42.1546 meters.

2065                                 **                                                                
2023                                ***                                                                
1981                               ******                                                              
1939                               *******                                                             
1896                              *********                                                            
1854                             ***********                                                           
1812                             ***********                                                           
1770                            *************                                                          
1728                            **************                                                         
1686                           ****************                                                        
1644 **                       ******************                                                       
1601 ****                    ***********************                                                   
1559 *****                  *************************                                                  
1517 *******                **************************                                                 
1475 ********              ****************************                                                
1433 **********          *******************************                                               
1391 ***********        ********************************                                               
1348 ************    ***********************************                                               
1306 ****************************************************                                              
1264 *****************************************************                                             
1222 *****************************************************                                             
1180 ******************************************************                                            
1138 ******************************************************                                            
1096 *******************************************************                                           
1053 ********************************************************                                          
1011 *********************************************************                                       * 
969  **********************************************************                                     ** 
927  ***********************************************************          * **                     *** 
885  *************************************************************    ************                **** 
843  *******************************************************************************              **** 
800  *********************************************************************************   *****  ****** 
758  ************************************************************************************************* 
716  ************************************************************************************************* 
674  ************************************************************************************************* 
632  **************************************************************************************************
590  **************************************************************************************************
548  **************************************************************************************************
505  **************************************************************************************************
463  **************************************************************************************************
421  **************************************************************************************************
379  **************************************************************************************************
337  **************************************************************************************************
295  **************************************************************************************************
252  **************************************************************************************************
210  **************************************************************************************************
168  **************************************************************************************************
126  **************************************************************************************************
84   **************************************************************************************************
42   **************************************************************************************************
0    **************************************************************************************************
</pre>
"""

if __name__ == '__main__':
    app.run()